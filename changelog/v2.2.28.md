# 🚀 OpenClaw 企业微信 (WeCom) 插件 v2.2.28 - 多账号隔离与稳定性增强

本次 v2.2.28 版本是 **OpenClaw 企业微信 (WeCom) 插件** 的一次重大里程碑更新。我们深度优化了 **微信 / 企业微信** 办公场景下的多智能体隔离逻辑，并修复了生命周期、XML 数据保真等多个生产环境的核心痛点。

本次更新让 **OpenClaw** 在处理企业级复杂 **插件** 配置时更加得心应手，完美解决大模型接入 **WeCom** 的所有阻碍。

---

### 🌟 版本亮点 (Release Highlights)

*   🎯 **多账号矩阵支持**：支持按 `accountId` 进行组内会话隔离。不同部门、不同业务的 **企业微信** 机器人可并行运行，互不干扰，彻底解决跨账号串会话问题。
*   🔐 **数据保真解析**：针对 **WeCom** 的 XML 消息解析进行了重构。关闭了自动数值化，保留 `FromUserName` 前导 `0`，并完美解决 64 位 `MsgId` 精度风险。
*   🔁 **Gateway 生命周期适配**：完美兼容最新版 **OpenClaw** Gateway 的生命周期管理，修复了在高频心跳监测下的重启循环问题，运行更稳健。
*   🧹 **入站消息过滤**：优化了 **微信** 与 **企业微信** 的事件过滤逻辑，避免系统事件、缺失发送者等无效消息进入 AI 会话，防止“误回复”。
*   🧱 **配置安全护栏**：新增 **企业微信** 账号冲突检测。自动拦截重复的 `bot.token` 或 `agentId` 配置，并提供友好的中文错误提示。

---

### 📝 详细更新日志 (Changelog)

#### 【重磅更新】🎯 多账号/多智能体可用性增强
- 支持按 `accountId` 做组内隔离（Bot + Agent + 路由绑定同组生效）。
- 动态 Agent 与会话键增加 `accountId` 维度，避免跨账号串会话。

#### 【稳定性】🔁 生命周期兼容修复
- 适配新版 **OpenClaw** Gateway 生命周期，`startAccount` 改为长生命周期运行。
- 修复了“几秒一次重启 + health-monitor 二次重启”的循环问题。

#### 【准确性】🔐 XML 字段保真修复
- **WeCom** Agent XML 解析关闭自动数值化，保留发送者原始 ID。
- 避免 `MsgId` (64bit) 精度损失，确保回复目标不被误改。

#### 【准确性】🧹 误回复修复
- Bot/Agent 入站均增加事件过滤，避免处理 `event`、`sys` 及缺失发送者的消息。
- 修复群聊缺失 `chatid` 时仍进入 AI 会话的问题，避免“一个消息触发多人误回复”。

#### 【可控性】🧱 配置安全护栏
- 新增多账号冲突检测，自动拦截重复 Token 或 Agent ID 的配置。
- **账号管理修复**：`deleteAccount` 现在仅删除目标账号，不再误删整个 **插件** 的 `channels.wecom` 配置。

#### 【质量保障】✅ 自动化回归
- 新增账号解析、冲突检测、动态路由隔离、生命周期与入站过滤的多项自动化测试。
- **文档优化**：README 快速开始文档更新，优先展示“多账号 + 多 Agent”矩阵配置。

---

### 💾 安装与升级 (Install & Update)

使用 **OpenClaw** CLI 即可一键升级 **插件**：

```bash
openclaw plugins upgrade wecom
```

或手动更新配置：
```bash
openclaw config set channels.wecom.enabled true
```

---

### 🔍 SEO 关键词 (Keywords)
**openclaw** | **企业微信** | **微信** | **wecom** | **插件** | **AI 机器人** | **大模型网关** | **流式响应** | **多账号隔离** | **WeCom Plugin**

---

### 📮 联系我们
如果您在 **企业微信 / 微信** 接入过程中遇到任何问题，欢迎提交 Issue 或加入我们的交流群。

> **提示**：建议 **OpenClaw** 主程序版本保持在 **2026.2.24+** 以获得最佳体验。
